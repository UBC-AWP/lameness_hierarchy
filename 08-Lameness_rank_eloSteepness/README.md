# Lameness Ranking Using EloSteepness

This folder contains code and data for constructing lameness hierarchies using the EloSteepness method applied to pairwise comparison data from both experts and MTurk workers.

## Directory Structure

- **code/**: R scripts for generating EloSteepness rankings
  - `eloSteepness_lame_rank_click_worker.r`: Script for generating lameness ranking based on click worker data
  - `eloSteepness_lame_rank_experts.r`: Script for generating lameness ranking based on expert data
  - `eloSteepness_helpers.R`: Helper functions for EloSteepness calculations

- **plots/**: Visualization outputs
  - `combined_plot_vertical.png`: Combined visualization in testing different subsampling algorithms
  - `expert_crowd_worker_hierarchy_compare_NV_DW_SB_KI.png`: Comparison of hierarchies between experts and crowd workers
  - `hierarchy_example.gif`: Animation illustrating each cow's video in the generated lameness hierarchy
  - `NV_DW_SB_KI_experts.png`: Visualization of lameness hierarchy generated by all experts

- **results/**: EloSteepness scoring results for different analysis methods
  - **Expert-Based Scores**:
    - `all_experts_scores.csv`: Summed Elo-winning probability score from all experts combined
    - `all_experts_steepness.csv`: Steepness measures in hierarchy generated from all experts
    - `DW_experts_scores.csv`: Summed Elo-winning probability score from expert DW
    - `DW_experts_steepness.csv`: Steepness measures in hierarchy generated from expert DW
    - `KI_experts_scores.csv`: Summed Elo-winning probability score from expert KI
    - `KI_experts_steepness.csv`: Steepness measures in hierarchy generated from expert KI
    - `NV_experts_scores.csv`: Summed Elo-winning probability score from expert NV
    - `NV_experts_steepness.csv`: Steepness measures in hierarchy generated from expert NV
    - `NV_DW_SB_KI_experts_scores.csv`: Summed Elo-winning probability score from combined experts NV, DW, SB, and KI
    - `NV_DW_SB_KI_experts_steepness.csv`: Steepness measures in hierarchy generated from combined experts
    - `SB_experts_scores.csv`: Summed Elo-winning probability score from expert SB
    - `SB_experts_steepness.csv`: Steepness measures in hierarchy generated from expert SB
    - `weighted_experts_scores.csv`: Summed Elo-winning probability score from all experts, if degree of lameness difference between every 2 cows is > 1, we duplicate the row by the degree of lameness difference (i.e., if cow A is more lame than cow B by degree of 2, we record 2 rows where cow A is the winner and cow B is the lower)
    - `weighted_experts_steepness.csv`: Steepness measures in hierarchy generated from all experts, if degree of lameness difference between every 2 cows is > 1, we duplicate the row by the degree of lameness difference (i.e., if cow A is more lame than cow B by degree of 2, we record 2 rows where cow A is the winner and cow B is the lower)
  
  - **Click Worker-Based Scores**:
    - `all_click_worker_scores.csv`: EloSteepness scores from all MTurk click workers' pairwise assessments
    - `all_click_worker_steepness.csv`: Hierarchy steepness measures from all workers
    - `sampled_click_worker_scores.csv`: EloSteepness scores generated using the subsampling algorithm sampling equal number of workers per cow pair
    - `sampled_click_worker_steepness.csv`: Steepness from equal worker sampling
    - `sampled_delete_click_worker_scores.csv`: Scores generated using the subsampling algorithm where all pairs with average response between (-1, 1) were removed
    - `sampled_delete_click_worker_steepness.csv`: Steepness after removing ambiguous pairs
    - `sampled_exchange0_click_worker_scores.csv`: Scores where ambiguous pairs (avg response between -1 and 1) are changed to half of the responses record A more lame than B and the other half record B more lame than A (i.e., balanced ambiguous pairs).
    - `sampled_exchange0_click_worker_steepness.csv`: Steepness for the balanced ambiguous pairs approach
    - `sampled_ind_exchange0_click_worker_scores.csv`: Scores where individual worker responses between [-1, 1] were set to 0
    - `sampled_ind_exchange0_click_worker_steepness.csv`: Steepness for individual response thresholding
    - `sampled_milestone_min_click_worker_scores.csv`: EloSteepness scores generated using the subsampling algorithm using 5 milestone cows (GS: 1.9, 2.4, 2.87, 3.1, 3.9) with minimum comparison strategy (~106 comparisons)
    - `sampled_milestone_min_click_worker_steepness.csv`: Steepness of hierarchy generated using the 5 milestone comparison method
    - `sampled_milestone_max_click_worker_scores.csv`: Scores using 5 milestone cows with maximum comparison strategy (125 comparisons)
    - `sampled_milestone_max_click_worker_steepness.csv`: Steepness for maximum milestone comparison method

- **Comparison File**:
  - `compare_summary.csv`: Comprehensive comparison of all expert and worker methods with means and SDs
  - `milestone_worker_num_ICC_change.rdata`: Analysis showing how ICC and Spearman correlation change when incrementally subsampling 1-14 workers per cow pair using the milestone approach

## Data Files Description

### Score Files (*_scores.csv)

All files ending with "_scores.csv" share a common structure:

- `Cow`: Cow ID number
- Second column (varies by file): Average summed Elo-winning probability for the cow
- Third column (varies by file): Standard deviation of the summed Elo-winning probability

The second and third column names vary based on which responses were used to calculate the Elo-winning probabilities.

### Steepness Files (*_steepness.csv)

All files ending with "_steepness.csv" contain:

- `method`: The method used for generating the EloSteepness lameness hierarchy
- `steepness_mean`: Mean steepness value of the lameness hierarchy
- `steepness_SD`: Standard deviation of the steepness value

### compare_summary.csv

Comprehensive comparison file containing:

- `Cow`: Cow ID number
- `GS`: Gait score
- Various columns for cumulative Elo-winning probability mean score and standard deviation in that distribution depending on the sampling method or whose responses were being used:
  - `all_click_worker_mean`, `all_click_worker_sd`
  - `sampled_click_worker_mean`, `sampled_click_worker_sd`
  - `sampled_delete_click_worker_mean`, `sampled_delete_click_worker_sd`
  - `sampled_exchange0_click_worker_mean`, `sampled_exchange0_click_worker_sd`
  - `sampled_ind_exchange0_click_worker_mean`, `sampled_ind_exchange0_click_worker_sd`
  - `sampled_milestone_min_click_worker_mean`, `sampled_milestone_min_click_worker_sd`
  - `sampled_milestone_max_click_worker_mean`, `sampled_milestone_max_click_worker_sd`
  - `DW_experts_mean`, `DW_experts_sd`
  - `NV_experts_mean`, `NV_experts_sd`
  - `NV_DW_experts_mean`, `NV_DW_experts_sd`
  - `SB_experts_mean`, `SB_experts_sd`
  - `KI_experts_mean`, `KI_experts_sd`
  - `NV_DW_SB_KI_experts_mean`, `NV_DW_SB_KI_experts_sd`

## EloSteepness Method

EloSteepness is a method used to construct dominance hierarchies based on pairwise comparison data. In this project, it's applied to lameness assessment where:

1. Each cow is assigned an Elo rating based on pairwise comparison outcomes
2. The "winning" cow in a comparison is the one considered more lame
3. Higher scores in the results indicate higher lameness severity
4. Steepness measures the degree of differentiation in the hierarchy

The various analysis methods compare different approaches to handling the pairwise comparison data from both experts and crowd workers, including sampling strategies, handling of ambiguous comparisons, and milestone-based approaches.
